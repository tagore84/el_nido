{
    "name": "nido.router.telegram",
    "nodes": [
        {
            "parameters": {
                "updates": [
                    "message",
                    "callback_query"
                ],
                "additionalFields": {}
            },
            "name": "Telegram Trigger",
            "type": "n8n-nodes-base.telegramTrigger",
            "typeVersion": 1,
            "position": [
                250,
                300
            ],
            "webhookId": "nido-router-telegram",
            "credentials": {
                "telegramApi": {
                    "id": "JLG33gMQcdi4JvQq",
                    "name": "Telegram account"
                }
            }
        },
        {
            "parameters": {
                "functionCode": "// Chat Map (Hardcoded)\nconst chatMap = {\n    \"Nido-Alberto\": \"5785514136\",\n    \"Nido-Alberto-Laura\": \"-5223730192\",\n    \"Nido-Alberto-Laura-Testing\": \"-5234536185\",\n    \"Nido-Laura\": \"PLACEHOLDER\"\n};\n\n// Get Chat ID from input\nconst body = items[0].json;\nlet chatId = null;\nlet type = 'other';\n\nif (body.callback_query) {\n    chatId = body.callback_query.message.chat.id;\n    type = 'callback';\n} else if (body.message) {\n    chatId = body.message.chat.id;\n    if (body.message.photo) type = 'photo';\n    else if (body.message.text) type = 'text';\n}\n\n// Resolve Name\nlet chatName = 'Unknown';\n// Iterate map to find key by value (ID)\nfor (const [name, id] of Object.entries(chatMap)) {\n    if (String(id) === String(chatId)) {\n        chatName = name;\n        break;\n    }\n}\n\nreturn [{\n    json: {\n        ...body,\n        _routing: {\n            chatId,\n            chatName,\n            type\n        }\n    }\n}];"
            },
            "name": "Identify Chat",
            "type": "n8n-nodes-base.function",
            "typeVersion": 1,
            "position": [
                450,
                300
            ]
        },
        {
            "parameters": {
                "dataType": "string",
                "value1": "={{ $json._routing.chatName }}::{{ $json._routing.type }}",
                "rules": {
                    "rules": [
                        {
                            "value2": "Nido-Alberto::photo",
                            "output": 0
                        },
                        {
                            "value2": "Nido-Alberto::text",
                            "output": 1
                        },
                        {
                            "value2": "Nido-Alberto::callback",
                            "output": 2
                        },
                        {
                            "value2": "Nido-Alberto-Laura-Testing::text",
                            "output": 3
                        }
                    ]
                }
            },
            "name": "Route Traffic",
            "type": "n8n-nodes-base.switch",
            "typeVersion": 1,
            "position": [
                650,
                300
            ]
        },
        {
            "parameters": {
                "workflowId": "ObAxXSSjiG0Q-w4iDQi5T",
                "mode": "each",
                "options": {}
            },
            "name": "Route to Photo",
            "type": "n8n-nodes-base.executeWorkflow",
            "typeVersion": 1,
            "position": [
                850,
                200
            ]
        },
        {
            "parameters": {
                "workflowId": "9XBuTBG2fHkmq2PH52Esi",
                "mode": "each",
                "options": {}
            },
            "name": "Route to Text",
            "type": "n8n-nodes-base.executeWorkflow",
            "typeVersion": 1,
            "position": [
                850,
                400
            ]
        },
        {
            "parameters": {
                "workflowId": "18JO8AMXiXDnR9-tU-POb",
                "mode": "each",
                "options": {}
            },
            "name": "Route to Review",
            "type": "n8n-nodes-base.executeWorkflow",
            "typeVersion": 1,
            "position": [
                850,
                600
            ]
        },
        {
            "parameters": {
                "workflowId": "placeholder-shared-text",
                "mode": "each",
                "options": {}
            },
            "name": "Route to Shared Text",
            "type": "n8n-nodes-base.executeWorkflow",
            "typeVersion": 1,
            "position": [
                850,
                800
            ]
        }
    ],
    "connections": {
        "Telegram Trigger": {
            "main": [
                [
                    {
                        "node": "Identify Chat",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Identify Chat": {
            "main": [
                [
                    {
                        "node": "Route Traffic",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Route Traffic": {
            "main": [
                [
                    {
                        "node": "Route to Photo",
                        "type": "main",
                        "index": 0
                    }
                ],
                [
                    {
                        "node": "Route to Text",
                        "type": "main",
                        "index": 0
                    }
                ],
                [
                    {
                        "node": "Route to Review",
                        "type": "main",
                        "index": 0
                    }
                ],
                [
                    {
                        "node": "Route to Shared Text",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        }
    },
    "active": true
}